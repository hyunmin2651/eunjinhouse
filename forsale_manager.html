<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§¤ë¬¼ ê´€ë¦¬ - ì€ì§„ë¶€ë™ì‚°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        header {
            background:#ffffff;
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 60px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: rgb(0, 0, 0);
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        .login-container {
            max-width: 400px;
            margin: 5rem auto;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .login-container h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 2rem;
        }

        .admin-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: none;
        }

        .admin-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            color: #1e3c72;
        }

        .header-buttons {
            display: flex;
            gap: 1rem;
        }

        .logout-btn, .add-btn {
            padding: 0.8rem 1.5rem;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }

        .logout-btn {
            background: #dc3545;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .add-btn {
            background: #28a745;
        }

        .add-btn:hover {
            background: #218838;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .login-btn, .submit-btn, .cancel-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .login-btn, .submit-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .login-btn:hover, .submit-btn:hover {
            opacity: 0.9;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            margin-top: 0.5rem;
        }

        .cancel-btn:hover {
            background: #5a6268;
        }

        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 1rem;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 15px;
            max-width: 600px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #1e3c72;
        }

        .close {
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .properties-grid {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .properties-grid h2 {
            color: #1e3c72;
            margin-bottom: 1.5rem;
        }

        .property-table {
            width: 100%;
            border-collapse: collapse;
        }

        .property-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            border-bottom: 2px solid #e0e0e0;
            color: #333;
        }

        .property-table td {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .property-table tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn, .delete-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .edit-btn {
            background: #007bff;
            color: white;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-message {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2a5298;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1e3c72;
            margin-bottom: 0.5rem;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="index.html"><img src="logo.png" alt="ì€ì§„ë¶€ë™ì‚° ë¡œê³ "></a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="forsale.html">ë§¤ë¬¼ì •ë³´</a></li>
            </ul>
        </nav>
    </header>

    <div class="login-container" id="loginContainer">
        <h1>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
        <form id="loginForm">
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
            <div class="error-message" id="errorMessage">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </form>
    </div>

    <div class="admin-container" id="adminContainer">
        <div class="admin-header">
            <h1>ğŸ¢ ë§¤ë¬¼ ê´€ë¦¬</h1>
            <div class="header-buttons">
                <button class="add-btn" onclick="openAddModal()">â• ë§¤ë¬¼ ì¶”ê°€</button>
            </div>
        </div>
        <div class="properties-grid">
            <h2>ë“±ë¡ëœ ë§¤ë¬¼ ëª©ë¡</h2>
            <div id="propertyTableContainer">
                <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <!-- ë§¤ë¬¼ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ë§¤ë¬¼ ì¶”ê°€</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="propertyForm">
                <div class="form-group">
                    <label for="propertyType">ë§¤ë¬¼ì¢…ë¥˜ *</label>
                    <select id="propertyType" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
                        <option value="ë¹Œë¼">ë¹Œë¼</option>
                        <option value="ì˜¤í”¼ìŠ¤í…”">ì˜¤í”¼ìŠ¤í…”</option>
                        <option value="ë‹¨ë…ì£¼íƒ">ë‹¨ë…ì£¼íƒ</option>
                        <option value="ìƒê°€">ìƒê°€</option>
                        <option value="í† ì§€">í† ì§€</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="dealType">ê±°ë˜ìœ í˜• *</label>
                    <select id="dealType" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ë§¤ë§¤">ë§¤ë§¤</option>
                        <option value="ì „ì„¸">ì „ì„¸</option>
                        <option value="ì›”ì„¸">ì›”ì„¸</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="address">ì£¼ì†Œ *</label>
                    <input type="text" id="address" placeholder="ì˜ˆ: ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ë™ 123" required>
                </div>

                <div class="form-group">
                    <label for="price">ê°€ê²© *</label>
                    <input type="text" id="price" placeholder="ì˜ˆ: 5ì–µ ë˜ëŠ” ì „ì„¸ 3ì–µ ë˜ëŠ” ì›”ì„¸ 100/50" required>
                </div>

                <div class="form-group">
                    <label for="area">ë©´ì </label>
                    <input type="text" id="area" placeholder="ì˜ˆ: 84ã¡">
                </div>

                <div class="form-group">
                    <label for="rooms">ë°©ê°œìˆ˜</label>
                    <input type="text" id="rooms" placeholder="ì˜ˆ: 3">
                </div>

                <div class="form-group">
                    <label for="bathrooms">ìš•ì‹¤ê°œìˆ˜</label>
                    <input type="text" id="bathrooms" placeholder="ì˜ˆ: 2">
                </div>

                <div class="form-group">
                    <label for="description">ì„¤ëª…</label>
                    <textarea id="description" placeholder="ë§¤ë¬¼ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label for="imageFile">ë§¤ë¬¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</label>
                    <input type="file" id="imageFile" accept="image/*" multiple style="padding: 0.5rem;">
                    <div id="imagePreview" style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
                    <div id="uploadStatus" style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;"></div>
                </div>

                <button type="submit" class="submit-btn">ì €ì¥</button>
                <button type="button" class="cancel-btn" onclick="closeModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = '2651andy!';
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx_AOHN5QKRqQiLq-Cdrj-NAUgdA4txgNGSbKRzrhzY4pMEjKrwkatqwCgpHGNj-4WXiQ/exec';
        let allProperties = [];
        let editingRowIndex = null;
        let uploadedImageUrls = [];

        // ë¡œê·¸ì¸
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                loadProperties();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        });

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('password').value = '';
            document.getElementById('errorMessage').style.display = 'none';
        }

        // ë§¤ë¬¼ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadProperties() {
            const container = document.getElementById('propertyTableContainer');
            container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            try {
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();
                
                console.log('ë°›ì€ ë°ì´í„°:', result);

                if (result.status === 'success') {
                    allProperties = result.data || [];
                    displayProperties();
                } else {
                    throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }

            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<div class="empty-message">âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ë§¤ë¬¼ í‘œì‹œ
        function displayProperties() {
            const container = document.getElementById('propertyTableContainer');
            
            if (allProperties.length === 0) {
                container.innerHTML = '<div class="empty-message">ğŸ“­ ë“±ë¡ëœ ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>Google Sheetsì— ë§¤ë¬¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            container.innerHTML = `
                <table class="property-table">
                    <thead>
                        <tr>
                            <th>ë§¤ë¬¼ì¢…ë¥˜</th>
                            <th>ê±°ë˜ìœ í˜•</th>
                            <th>ì£¼ì†Œ</th>
                            <th>ê°€ê²©</th>
                            <th>ë©´ì </th>
                            <th>ë°©/ìš•ì‹¤</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allProperties.map((prop, index) => `
                            <tr>
                                <td>${prop['ë§¤ë¬¼ì¢…ë¥˜'] || '-'}</td>
                                <td>${prop['ê±°ë˜ìœ í˜•'] || '-'}</td>
                                <td>${prop['ì£¼ì†Œ'] || '-'}</td>
                                <td><strong>${prop['ê°€ê²©'] || '-'}</strong></td>
                                <td>${prop['ë©´ì '] || '-'}</td>
                                <td>${prop['ë°©ê°œìˆ˜'] || '-'}/${prop['ìš•ì‹¤ê°œìˆ˜'] || '-'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="edit-btn" onclick="editProperty(${index})">âœï¸ ìˆ˜ì •</button>
                                        <button class="delete-btn" onclick="deleteProperty(${index})">ğŸ—‘ï¸ ì‚­ì œ</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ëª¨ë‹¬ ì—´ê¸° (ì¶”ê°€)
        function openAddModal() {
            editingRowIndex = null;
            uploadedImageUrls = [];
            document.getElementById('propertyModal').style.display = 'block';
            document.getElementById('modalTitle').textContent = 'ë§¤ë¬¼ ì¶”ê°€';
            document.getElementById('propertyForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('uploadStatus').textContent = '';
        }

        // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function editProperty(index) {
            editingRowIndex = index;
            uploadedImageUrls = [];
            const prop = allProperties[index];
            
            document.getElementById('propertyModal').style.display = 'block';
            document.getElementById('modalTitle').textContent = 'ë§¤ë¬¼ ìˆ˜ì •';
            
            document.getElementById('propertyType').value = prop['ë§¤ë¬¼ì¢…ë¥˜'] || '';
            document.getElementById('dealType').value = prop['ê±°ë˜ìœ í˜•'] || '';
            document.getElementById('address').value = prop['ì£¼ì†Œ'] || '';
            document.getElementById('price').value = prop['ê°€ê²©'] || '';
            document.getElementById('area').value = prop['ë©´ì '] || '';
            document.getElementById('rooms').value = prop['ë°©ê°œìˆ˜'] || '';
            document.getElementById('bathrooms').value = prop['ìš•ì‹¤ê°œìˆ˜'] || '';
            document.getElementById('description').value = prop['ì„¤ëª…'] || '';
            
            // ê¸°ì¡´ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            if (prop['ì´ë¯¸ì§€URL']) {
                const urls = prop['ì´ë¯¸ì§€URL'].split(',').filter(url => url.trim());
                uploadedImageUrls = urls;
                const previewDiv = document.getElementById('imagePreview');
                previewDiv.innerHTML = urls.map(url => 
                    `<img src="${url.trim()}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 10px;">`
                ).join('');
            } else {
                document.getElementById('imagePreview').innerHTML = '';
            }
            
            document.getElementById('uploadStatus').textContent = '';
        }

        // ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë° ì—…ë¡œë“œ (ì—¬ëŸ¬ ì¥)
        document.getElementById('imageFile').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            document.getElementById('uploadStatus').textContent = `${files.length}ê°œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...`;
            const previewDiv = document.getElementById('imagePreview');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // ë¯¸ë¦¬ë³´ê¸°
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.cssText = 'width: 100px; height: 100px; object-fit: cover; border-radius: 10px;';
                    previewDiv.appendChild(img);
                };
                reader.readAsDataURL(file);

                // Google Driveì— ì—…ë¡œë“œ
                const reader2 = new FileReader();
                await new Promise((resolve, reject) => {
                    reader2.onload = async function(event) {
                        try {
                            const base64Data = event.target.result;
                            
                            const response = await fetch(SCRIPT_URL, {
                                method: 'POST',
                                body: JSON.stringify({
                                    action: 'upload',
                                    imageData: base64Data,
                                    fileName: file.name,
                                    mimeType: file.type
                                })
                            });

                            const result = await response.json();
                            
                            if (result.status === 'success') {
                                uploadedImageUrls.push(result.imageUrl);
                                document.getElementById('uploadStatus').textContent = `âœ… ${i + 1}/${files.length} ì—…ë¡œë“œ ì™„ë£Œ!`;
                                document.getElementById('uploadStatus').style.color = '#28a745';
                            } else {
                                throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨');
                            }
                            resolve();

                        } catch (error) {
                            console.error('Upload error:', error);
                            document.getElementById('uploadStatus').textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                            document.getElementById('uploadStatus').style.color = '#dc3545';
                            reject(error);
                        }
                    };
                    reader2.readAsDataURL(file);
                });
            }
        });

        // ë§¤ë¬¼ ì‚­ì œ
        async function deleteProperty(index) {
            if (!confirm('ì´ ë§¤ë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            const prop = allProperties[index];
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'delete',
                        rowIndex: prop.rowIndex
                    })
                });

                alert('ë§¤ë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadProperties();

            } catch (error) {
                console.error('Error:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('propertyModal').style.display = 'none';
        }

        // í¼ ì œì¶œ
        document.getElementById('propertyForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                action: editingRowIndex !== null ? 'update' : 'add',
                ë§¤ë¬¼ì¢…ë¥˜: document.getElementById('propertyType').value,
                ê±°ë˜ìœ í˜•: document.getElementById('dealType').value,
                ì£¼ì†Œ: document.getElementById('address').value,
                ê°€ê²©: document.getElementById('price').value,
                ë©´ì : document.getElementById('area').value,
                ë°©ê°œìˆ˜: document.getElementById('rooms').value,
                ìš•ì‹¤ê°œìˆ˜: document.getElementById('bathrooms').value,
                ì„¤ëª…: document.getElementById('description').value,
                ì´ë¯¸ì§€URL: uploadedImageUrls.join(','), // ì—¬ëŸ¬ URLì„ ì‰¼í‘œë¡œ ì—°ê²°
                ìœ„ë„: '',
                ê²½ë„: ''
            };

            // ìˆ˜ì •ì¸ ê²½ìš° rowIndex ì¶”ê°€
            if (editingRowIndex !== null) {
                formData.rowIndex = allProperties[editingRowIndex].rowIndex;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                alert(editingRowIndex !== null ? 'ë§¤ë¬¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë§¤ë¬¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
                
                // 1ì´ˆ í›„ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    loadProperties();
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('propertyModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>